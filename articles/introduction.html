<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example script • seatrackfunctions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example script">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">seatrackfunctions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Example script</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jevansbio/seatrack_functions/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example script</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jevansbio/seatrack_functions/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Loading the library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jevansbio/seatrack_functions" class="external-link">seatrackfunctions</a></span><span class="op">)</span></span></code></pre></div>
<p>There are a few things that need to be set before the functions can
be used.</p>
<p>It is important that we can monitor changes made and the reasoning
behind them. This package uses the <a href="https://cran.r-project.org/web/packages/logger/index.html" class="external-link">logger</a>
package for logging. This will print messages to the console and write
them to a file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/start_logging.html">start_logging</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>By default the logging level is set to <strong>INFO</strong>. You can
also set the scripts to be more verbose by changing the log
threshold:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log_threshold</span> <span class="op">(</span><span class="va">TRACE</span><span class="op">)</span></span></code></pre></div>
<p>For more information about different logger levels see <a href="https://daroczig.github.io/logger/reference/log_levels.html" class="external-link">log_levels</a>.</p>
<p>You also need to point the package to where the seatrack directory is
placed in your file system. This variable will be used by many functions
contained in this package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_to_seatrack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"a_filepath"</span>,<span class="st">"SEATRACK - shared"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_sea_track_folder.html">set_sea_track_folder</a></span><span class="op">(</span><span class="va">path_to_seatrack</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; INFO [2025-09-12 10:52:30] Sea track folder set to: a_filepath/SEATRACK - shared</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h2>
<p>Once this is set up you can open a partner metadata file. Note that
the files shown in this vignette are missing a number of columns present
in the real files.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">partner_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_partner_metadata.html">load_partner_metadata</a></span><span class="op">(</span><span class="st">"Metadata_SEATRACK_2025-TestColony.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>This loads the Excel file into R as a list, where each element of the
list is different sheet of the Excel file.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">partner_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ENCOUNTER DATA" "LOGGER RETURNS" "RESTART TIMES"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">partner_data</span><span class="op">$</span><span class="va">`LOGGER RETURNS`</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   logger_id status     `download / stop_date` `downloaded by` comment        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L1        Downloaded 2025-01-10             User            Logger returned</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: `stored or sent to?` &lt;chr&gt;</span></span></span></code></pre></div>
<p>You can then load the master file that you wish to update. This can
be done by using the colony name.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master_import</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_master_import.html">load_master_import</a></span><span class="op">(</span><span class="st">"TestColony"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Master import file for colony 'TestColony' found at: a_filepath/SEATRACK - shared/Database/Imports_Metadata/imports_TestColony_2025.xlsx</span></span></code></pre>
<p>The function returns a list with two elements, <code>data</code> and
<code>path</code>. <code>path</code> is the full file path of the
loaded. <code>data</code> is a list, where each element is a sheet from
the imported master file</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">master_import</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "METADATA"         "STARTUP_SHUTDOWN"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">master_import</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">METADATA</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   date       ring_number logger_id_deployed logger_id_retrieved colony   comment</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2024-01-10 42          L1                 <span style="color: #BB0000;">NA</span>                  TestCol… A smal…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>There are several steps to updating the master import sheet. Firstly
checking startup files for missing logger sessions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master_import_data</span> <span class="op">&lt;-</span> <span class="va">master_import</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">updated_startup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_loggers_from_startup.html">add_loggers_from_startup</a></span><span class="op">(</span><span class="va">master_import_data</span><span class="op">$</span><span class="va">`STARTUP_SHUTDOWN`</span><span class="op">)</span></span></code></pre></div>
<p>Then appending reported encounter data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">updated_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_encounter_data.html">append_encounter_data</a></span><span class="op">(</span><span class="va">master_import_data</span><span class="op">$</span><span class="va">METADATA</span>, <span class="va">partner_data</span><span class="op">$</span><span class="va">`ENCOUNTER DATA`</span><span class="op">)</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Appended 1 rows to master metadata. New total is 2 rows.</span></span></code></pre></div>
<p>Finally the processing reported logger returns and attempts to update
the appropriate session in the master startup sheet, setting download
status and dates.</p>
<p>This function also handles loggers that the partner restearts,
generating new sessions for them in the master startup sheet.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">updated_sessions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handle_returned_loggers.html">handle_returned_loggers</a></span><span class="op">(</span><span class="st">"TestColony"</span>, <span class="va">updated_startup</span>, <span class="va">partner_data</span><span class="op">$</span><span class="va">`LOGGER RETURNS`</span>, <span class="va">partner_data</span><span class="op">$</span><span class="va">`RESTART TIMES`</span><span class="op">)</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Found unfinished session for logger ID: L1 2025-01-10</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Unfinished session:</span></span>
<span><span class="co">#&gt;   logger_serial_no starttime_gmt intended_species intended_location</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L1               2024-01-01    bird             TestColony       </span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Updated 1 sessions.</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Updated sessions:</span></span>
<span><span class="co">#&gt;   logger_serial_no starttime_gmt download_type download_date</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L1               2024-01-01    Downloaded    2025-01-10</span></span></code></pre></div>
<p>At every stage, the log will report the changes that the functions
have made to the master sheet. The log will also report when it is
unable to handle some part of the partner supplied metadata. This can
help identify areas that need manually fixing in either the partner
metadata sheet or the master sheet.</p>
</div>
<div class="section level2">
<h2 id="combined-workflow">Combined workflow<a class="anchor" aria-label="anchor" href="#combined-workflow"></a>
</h2>
<p>This workflow can be run using a single function,
<code>handle_partner_metadata</code> that takes the colony name and the
imported excel files as arguments.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_master_sheets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/handle_partner_metadata.html">handle_partner_metadata</a></span><span class="op">(</span><span class="st">"TestColony"</span>, <span class="va">partner_data</span>, <span class="va">master_import_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; INFO [2025-09-12 10:52:31] Add missing sessions from start up files</span></span>
<span><span class="co">#&gt; INFO [2025-09-12 10:52:31] Append encounter data</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Appended 1 rows to master metadata. New total is 2 rows.</span></span>
<span><span class="co">#&gt; INFO [2025-09-12 10:52:31] Update sessions from logger returns</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Found unfinished session for logger ID: L1 2025-01-10</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Unfinished session:</span></span>
<span><span class="co">#&gt;   logger_serial_no starttime_gmt intended_species intended_location</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L1               2024-01-01    bird             TestColony       </span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Updated 1 sessions.</span></span>
<span><span class="co">#&gt; SUCCESS [2025-09-12 10:52:31] Updated sessions:</span></span>
<span><span class="co">#&gt;   logger_serial_no starttime_gmt download_type download_date</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> L1               2024-01-01    Downloaded    2025-01-10</span></span></code></pre></div>
<p>Finally, if you are happy with the changes made, you can save the
updated master sheet.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_master_sheet.html">save_master_sheet</a></span><span class="op">(</span><span class="va">new_master_sheets</span>, <span class="va">master_import</span><span class="op">$</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Julian Evans.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
